<!DOCTYPE html>
<html lang="en">

<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <link rel="stylesheet" href="global.css">
  <link rel="stylesheet" href="style.css">
  <link rel="icon" type="image/svg+xml" href="img/TOVA_favicon.svg">

  <!-- Security: Content Security Policy -->
  <meta http-equiv="Content-Security-Policy" content="
    default-src 'self';
    script-src 'self' 'unsafe-inline' https://www.gstatic.com https://kit.fontawesome.com https://cdn.jsdelivr.net;
    style-src 'self' 'unsafe-inline' https://fonts.googleapis.com;
    font-src 'self' https://fonts.gstatic.com https://ka-f.fontawesome.com;
    img-src 'self' data: https:;
    connect-src 'self' https://firestore.googleapis.com https://identitytoolkit.googleapis.com https://securetoken.googleapis.com https://ka-f.fontawesome.com https://api.open-meteo.com;
    frame-src 'self' https://www.youtube.com;
  ">

  <!-- Google Fonts: Outfit & Quicksand -->
  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link
    href="https://fonts.googleapis.com/css2?family=Outfit:wght@300;500;700;900&family=Quicksand:wght@400;600;700&display=swap"
    rel="stylesheet">
  <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>

  <title>TOVA - Portal</title>
  <meta name="description"
    content="TOVA Portal - The ultimate logistics management platform. Real-time metrics, industry news, and AI-powered insights for the modern supply chain.">
  <meta property="og:title" content="TOVA - Portal">
  <meta property="og:description"
    content="TOVA Portal - The ultimate logistics management platform. Real-time metrics, industry news, and AI-powered insights.">
  <meta property="og:image" content="https://tova.inc/img/og-image.png">
  <meta property="og:type" content="website">
</head>

<body>


  <header>
    <div class="logo">
      <img src="img/tova-logo.svg" alt="TOVA Logo" />
    </div>
    <div class="auth-buttons" style="display: flex; align-items: center; gap: 10px;">
      <!-- Language Selector -->
      <select id="lang-selector" onchange="changeLanguage(this.value)"
        style="padding: 6px; border-radius: 6px; border: 1px solid #ccc; font-size: 14px;">
        <option value="en">English</option>
        <option value="ja">日本語</option>
        <option value="ko">한국어</option>
        <option value="zh">中文</option>
      </select>

      <button id="theme-toggle" class="btn btn-outline" style="padding: 8px 12px; border: none; font-size: 18px;">
        <i class="fa-solid fa-moon"></i>
      </button>
    </div>
  </header>

  <nav class="portal-nav">
    <a href="#" class="active"><i class="fa-solid fa-house"></i> <span data-i18n="nav.home">Home</span></a>
    <a href="cafe.html"><i class="fa-solid fa-mug-hot"></i> <span data-i18n="nav.cafe">Cafe</span></a>
    <a href="blog.html"><i class="fa-solid fa-pen-nib"></i> <span data-i18n="nav.blog">Blog</span></a>
    <a href="shopping.html"><i class="fa-solid fa-bag-shopping"></i> <span data-i18n="nav.shopping">Shopping</span></a>
    <a href="news.html"><i class="fa-solid fa-newspaper"></i> <span data-i18n="nav.news">News</span></a>
    <a href="map.html"><i class="fa-solid fa-map"></i> <span data-i18n="nav.map">Map</span></a>
  </nav>

  <!-- Hero Section -->
  <div class="hero-section">
    <div class="hero-content">
      <h1 data-i18n="hero.title">Logistics Management <br> <span style="color: var(--yellow-accent);">Redefined.</span>
      </h1>
      <p data-i18n="hero.subtitle">Experience the next generation of warehouse and inventory management systems.
        Efficient, reliable, and secure.
      </p>
      <div class="hero-features"
        style="color: rgba(255,255,255,0.9); font-weight: 600; font-size: 15px; margin-bottom: 30px; display: flex; gap: 15px;">
        <span><i class="fa-solid fa-check" style="color: var(--yellow-accent);"></i> Reduce inventory loss by 99%</span>
        <span><i class="fa-solid fa-check" style="color: var(--yellow-accent);"></i> Shorten lead time with AI</span>
      </div>
      <div class="hero-actions">
        <a href="register.html" class="btn btn-mint"
          style="background: var(--yellow-accent); color: var(--navy); border: none; padding: 14px 32px; font-size: 18px;"
          data-i18n="hero.getStarted">Get
          Started</a>
        <a href="#" class="btn btn-hero-outline" data-i18n="hero.learnMore">Learn
          More</a>
      </div>
    </div>
    <div class="hero-visual">
      <i class="fa-solid fa-network-wired" style="font-size: 120px; color: rgba(255,255,255,0.1);"></i>
    </div>
  </div>

  <!-- Main Content -->
  <div class="container">

    <!-- LEFT COLUMN (Main Content) -->
    <div class="main-column">

      <!-- Search Bar Section -->
      <div class="search-section" style="width: 100%; margin: 0 0 30px 0;">
        <div class="search-box">
          <i class="fa-solid fa-magnifying-glass search-icon"></i>
          <input type="text" placeholder="Search TOVA services, products, or updates..." id="search-input"
            data-i18n="search.placeholder" />
          <button class="btn btn-mint search-btn" id="search-button" data-i18n="search.button"
            style="display: flex; align-items: center; gap: 8px;">
            Search <img src="img/tova-logo.svg" alt="TOVA"
              style="height: 16px; filter: brightness(0) saturate(100%) invert(14%) sepia(23%) saturate(3882%) hue-rotate(198deg) brightness(93%) contrast(98%);">
          </button>
        </div>
        <ul class="suggest-list" id="suggest-list" style="width: 100%;"></ul>
      </div>

      <div class="product-grid">
        <a href="register.html" class="product-card">
          <div class="tag active">ACTIVE</div>
          <div class="icon-bg">
            <i class="fa-solid fa-registered"></i>
          </div>
          <h3 data-i18n="prod.register">Register System</h3>
          <p data-i18n="prod.register.desc">Manage user registration efficiently.</p>
        </a>

        <a href="schedule.html" class="product-card">
          <div class="tag active">NEW</div>
          <div class="icon-bg">
            <i class="fa-solid fa-calendar-days"></i>
          </div>
          <h3 data-i18n="prod.schedule">Schedule App</h3>
          <p data-i18n="prod.schedule.desc">Task management & Todo list.</p>
        </a>

        <div class="product-card">
          <div class="tag soon">PROTO</div>
          <div class="icon-bg">
            <i class="fa-solid fa-gamepad"></i>
          </div>
          <h3 data-i18n="prod.gaming">Gaming</h3>
          <p data-i18n="prod.gaming.desc">Coming soon...</p>
        </div>

        <a href="ai-chat.html" class="product-card">
          <div class="tag active">NEW</div>
          <div class="icon-bg">
            <i class="fa-solid fa-handshake-angle"></i>
          </div>
          <h3 data-i18n="prod.ai">AI Assistant</h3>
          <p data-i18n="prod.ai.desc">Chat with TOVA AI.</p>
        </a>

        <div class="product-card">
          <div class="icon-bg">
            <i class="fa-solid fa-chart-line"></i>
          </div>
          <h3 data-i18n="prod.analytics">TOVA Analytics</h3>
          <p data-i18n="prod.soon">Coming soon...</p>
        </div>

        <div class="product-card" id="admin-card" style="display: none;">
          <div class="icon-bg">
            <i class="fa-solid fa-gears"></i>
          </div>
          <h3 data-i18n="prod.admin">TOVA Admin</h3>
          <p data-i18n="prod.soon">Coming soon...</p>
        </div>

        <div class="product-card">
          <div class="icon-bg">
            <i class="fa-solid fa-screwdriver-wrench"></i>
          </div>
          <h3 data-i18n="prod.store">Store Builder</h3>
          <p data-i18n="prod.soon">Coming soon...</p>
        </div>
      </div>

      <!-- Dashboard Section -->
      <div class="dashboard-section" style="margin-bottom: 30px;">
        <h2><i class="fa-solid fa-chart-line"></i> <span data-i18n="dash.market">Market Watch</span></h2>
        <div style="display: flex; gap: 20px; overflow-x: auto; padding-bottom: 10px;">
          <div
            style="flex: 1; min-width: 250px; background: white; padding: 15px; border-radius: 16px; box-shadow: 0 4px 12px rgba(0,0,0,0.05);">
            <canvas id="fuelChart"></canvas>
          </div>
          <div
            style="flex: 1; min-width: 250px; background: white; padding: 15px; border-radius: 16px; box-shadow: 0 4px 12px rgba(0,0,0,0.05);">
            <canvas id="exchangeChart"></canvas>
          </div>
        </div>
      </div>



      <!-- News Section -->
      <div class="news">
        <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 20px;">
          <h2 data-i18n="news.title" style="margin: 0;">TOVA News</h2>
          <div class="news-tabs">
            <button class="news-tab active" data-category="All">All</button>
            <button class="news-tab" data-category="Logistics">Logistics</button>
            <button class="news-tab" data-category="Tech">Tech</button>
            <button class="news-tab" data-category="EC">EC</button>
            <button class="news-tab" data-category="Current">Current</button>
            <button class="news-tab" data-category="Entertainment">Entertainment</button>
          </div>
        </div>
        <div class="news-list">
          <!-- Content injected by JS -->
          <div style="text-align: center; padding: 20px; color: #888;">Loading news...</div>
        </div>
      </div>
    </div>

    <!-- RIGHT COLUMN (Sidebar) -->
    <div class="right-column">

      <!-- Login Box -->
      <div class="login-box-portal" id="login-box">
        <!-- Content injected by JS -->
        <div class="text-center">Loading...</div>
      </div>

      <!-- Clock Widget (Celestial) -->
      <div class="widget-card clock-widget-container">
        <div class="sky">
          <div class="celestial-body sun"><i class="fa-solid fa-sun"></i></div>
          <div class="celestial-body moon"><i class="fa-solid fa-moon"></i></div>
        </div>
        <div class="widget-header" style="position: relative; z-index: 2; border-bottom: none;">
          <span style="color: white; text-shadow: 0 1px 2px rgba(0,0,0,0.5);"><i class="fa-regular fa-clock"></i> <span
              data-i18n="widget.time">Time</span></span>
          <span class="location-display"
            style="font-size: 12px; color: white; text-shadow: 0 1px 2px rgba(0,0,0,0.5);">Tokyo</span>
        </div>
        <div id="clock-widget"
          style="font-size: 36px; font-weight: 800; text-align: center; color: white; position: relative; z-index: 2; text-shadow: 0 2px 4px rgba(0,0,0,0.3); margin-top: 10px;">
          --:--
        </div>
        <div id="date-widget"
          style="text-align: center; color: rgba(255,255,255,0.9); margin-top: 4px; position: relative; z-index: 2; text-shadow: 0 1px 2px rgba(0,0,0,0.3); font-weight: 500;">
          ----/--/--
        </div>
      </div>

      <!-- Weather Widget (Dynamic) -->
      <div class="widget-card weather-card-dynamic" id="weather-dynamic-bg">
        <div class="widget-header" style="border-bottom: none; margin-bottom: 0; position: relative; z-index: 2;">
          <span style="color: white; text-shadow: 0 1px 2px rgba(0,0,0,0.2);"><i class="fa-solid fa-cloud-sun"></i>
            <span data-i18n="widget.weather">Weather</span></span>
        </div>
        <div style="display: flex; align-items: center; justify-content: space-between; width: 100%; margin-top: 10px;">
          <i class="fa-solid fa-cloud weather-icon-dynamic"></i>
          <div class="weather-info-dynamic">
            <div class="temp-dynamic">--°C</div>
            <div class="condition-dynamic">...</div>
          </div>
        </div>
      </div>





      <!-- Trending News Widget -->
      <div class="widget-card">
        <div class="widget-header">
          <span><i class="fa-solid fa-arrow-trend-up"></i> <span data-i18n="widget.trending">Trending</span></span>
        </div>
        <ul class="news-list-widget">
          <li>1. TOVA Schedule App Released</li>
          <li>2. New AI Features Coming Soon</li>
          <li>3. Developer Conference 2025</li>
          <li>4. How to use Register System</li>
          <li>5. Best productivity tools</li>
        </ul>
      </div>

      <!-- Daily Poll Widget -->
      <div id="poll-widget-container" class="widget-card">
        <!-- Injected by JS -->
      </div>

    </div>
  </div>


  <!-- Footer -->
  <footer>
    <div class="social-links">
      <a href="#" target="_blank" aria-label="YouTube"><i class="fa-brands fa-youtube"></i></a>
      <a href="#" target="_blank" aria-label="X (Twitter)"><i class="fa-brands fa-x-twitter"></i></a>
      <a href="#" target="_blank" aria-label="LinkedIn"><i class="fa-brands fa-linkedin"></i></a>
      <a href="#" target="_blank" aria-label="Instagram"><i class="fa-brands fa-instagram"></i></a>
      <a href="#" target="_blank" aria-label="LINE"><i class="fa-brands fa-line"></i></a>
      <a href="#" target="_blank" aria-label="KakaoTalk"><i class="fa-solid fa-comment"></i></a>
      <a href="#" target="_blank" aria-label="TikTok"><i class="fa-brands fa-tiktok"></i></a>
    </div>
    <a href="company.html">Company</a>
    <a href="pricing.html">Pricing</a>
    <a href="api.html">API</a>
    <a href="blog.html">Dev Blog</a>
    <a href="contact.html">Contact</a>
    <br>
    <a href="privacy.html">Privacy Policy</a> | <a href="terms.html">Terms of Service</a>
    <br><br>
    © 2025 TOVA Inc. All rights reserved.
  </footer>

  <script src="https://kit.fontawesome.com/efe6c5ccc5.js" crossorigin="anonymous"></script>
  <script type="module" src="firebase-config.js"></script>
  <script src="theme.js" defer></script>


  <script src="js/google-search.js" defer></script>
  <script type="module" src="js/news-renderer.js"></script>
  <script src="js/dashboard-charts.js" defer></script>

  <script src="js/poll-widget.js" defer></script>


  <script type="module" src="js/location-manager.js"></script>
  <script type="module" src="js/language-manager.js"></script>
  <script type="module">
    import { monitorAuthState, loginUser, logoutUser } from "./auth.js";
    import { auth, db } from "./firebase-config.js";
    import { doc, getDoc } from "https://www.gstatic.com/firebasejs/11.0.2/firebase-firestore.js";

    const loginBox = document.getElementById("login-box");

    // Login Box Logic
    const showLoginForm = () => {
      loginBox.innerHTML = `
          <h3>TOVA Login</h3>
          <form id="portal-login-form">
            <input type="email" id="portal-email" class="input" placeholder="Email" style="margin-bottom: 10px; padding: 10px;" required>
            <input type="password" id="portal-password" class="input" placeholder="Password" style="margin-bottom: 14px; padding: 10px;" required>
            <button type="submit" class="login-btn-portal">Sign In</button>
            <div style="margin-top: 12px; font-size: 13px; display: flex; justify-content: space-between;">
              <a href="signup.html" style="color: var(--navy);">Sign Up</a>
              <a href="#" style="color: #888;">Forgot Password?</a>
            </div>
          </form>
        `;

      const form = document.getElementById("portal-login-form");
      if (form) {
        form.addEventListener("submit", async (e) => {
          e.preventDefault();
          const email = document.getElementById("portal-email").value;
          const password = document.getElementById("portal-password").value;
          const btn = e.target.querySelector("button");

          btn.textContent = "Signing In...";
          btn.disabled = true;

          try {
            await loginUser(email, password);
            // Auth state listener will update UI automatically
          } catch (error) {
            alert("Login failed: " + error.message);
            btn.textContent = "Sign In";
            btn.disabled = false;
          }
        });
      }
    };

    // Fallback: If auth takes too long (e.g. 2 seconds), show login form
    const loadTimeout = setTimeout(() => {
      if (loginBox.textContent.includes("Loading")) {
        console.log("Auth load timeout, showing login form");
        showLoginForm();
      }
    }, 2000);

    monitorAuthState(async (user) => {
      clearTimeout(loadTimeout); // Clear timeout if auth responds
      const adminCard = document.getElementById("admin-card");

      if (user) {
        // Logged In State
        let userName = user.email;

        // Fetch name from Firestore
        const docRef = doc(db, "users", user.uid);
        const docSnap = await getDoc(docRef);
        if (docSnap.exists()) {
          const data = docSnap.data();
          userName = data.name || user.email;

          // Check for Admin privileges
          if (data.isAdmin === true) {
            if (adminCard) adminCard.style.display = "block";
          } else {
            if (adminCard) adminCard.style.display = "none";
          }
        }

        loginBox.innerHTML = `
          <div class="user-profile-mini">
            <div class="mini-avatar"><i class="fa-solid fa-user"></i></div>
            <div class="user-info-mini">
              <div>${userName}</div>
              <span>${user.email}</span>
            </div>
          </div>
          <div style="display: flex; gap: 10px;">
            <a href="#" class="btn btn-mint" style="flex: 1; text-align: center; padding: 10px; font-size: 14px; background: var(--navy); border-color: var(--navy);">Dashboard</a>
            <button id="portal-logout-btn" class="btn btn-outline" style="flex: 1; padding: 10px; font-size: 14px; border-color: #ddd; color: #666;">Logout</button>
          </div>
        `;

        document.getElementById("portal-logout-btn").addEventListener("click", async () => {
          await logoutUser();
        });

      } else {
        // Logged Out State
        if (adminCard) adminCard.style.display = "none";
        showLoginForm();
      }
    });
  </script>
  <script src="js/tova-boot.js" type="module"></script>
</body>

</html>